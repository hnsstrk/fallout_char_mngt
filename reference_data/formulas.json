{
  "meta": {
    "source": "FVTT Fallout System (FalloutActor.mjs) + Fallout 2d20 TTRPG Rulebook",
    "fvtt_system_version": "11.16.4",
    "fvtt_core_version": "13.351",
    "extracted": "2025-11-23",
    "repository": "https://github.com/Muttley/foundryvtt-fallout",
    "purpose": "Derived statistics calculation formulas for character sheet generation",
    "validation_character": "Dr. Eloise 'Ellie' Harper (Level 4)"
  },
  "formulas": {
    "max_health": {
      "formula": "END + LCK + (Level - 1) - Radiation + health_bonus + (wellRested ? 2 : 0)",
      "description": "Maximum Hit Points calculation",
      "components": {
        "base": {
          "formula": "END + LCK",
          "description": "Starting HP at Level 1"
        },
        "level_progression": {
          "formula": "Level - 1",
          "description": "Each level-up adds +1 HP"
        },
        "radiation_penalty": {
          "formula": "-Radiation",
          "description": "Current radiation reduces max HP by 1 per rad point"
        },
        "health_bonus": {
          "formula": "health_bonus",
          "description": "Bonus from perks, items, or other sources",
          "json_path": "system.health.bonus"
        },
        "well_rested": {
          "formula": "wellRested ? 2 : 0",
          "description": "Well Rested condition grants +2 max HP",
          "json_path": "system.conditions.wellRested"
        }
      },
      "json_paths": {
        "END": "system.attributes.end.value",
        "LCK": "system.attributes.luc.value",
        "Level": "system.level.value",
        "Radiation": "system.radiation",
        "health_bonus": "system.health.bonus",
        "wellRested": "system.conditions.wellRested",
        "result": "system.health.max"
      },
      "validation": {
        "character": "Ellie (Level 4)",
        "END": 4,
        "LCK": 4,
        "Level": 4,
        "Radiation": 0,
        "health_bonus": 0,
        "wellRested": true,
        "calculated": 13,
        "screenshot": 13,
        "status": "✓ VALIDATED"
      }
    },
    "defense": {
      "formula": "AGI <= 8 ? 1 : 2",
      "description": "Defense value based on Agility",
      "logic": {
        "low_agility": {
          "condition": "AGI <= 8",
          "result": 1
        },
        "high_agility": {
          "condition": "AGI >= 9",
          "result": 2
        },
        "bonus": {
          "formula": "+ defense_bonus",
          "description": "Additional defense from items/perks",
          "json_path": "system.defense.bonus"
        }
      },
      "json_paths": {
        "AGI": "system.attributes.agi.value",
        "defense_bonus": "system.defense.bonus",
        "result": "system.defense.value"
      },
      "validation": {
        "character": "Ellie (Level 4)",
        "AGI": 6,
        "defense_bonus": 0,
        "calculated": 1,
        "screenshot": 1,
        "status": "✓ VALIDATED"
      }
    },
    "initiative": {
      "formula": "PER + AGI + initiative_bonus",
      "description": "Initiative determines combat order",
      "components": {
        "base": {
          "formula": "PER + AGI",
          "description": "Sum of Perception and Agility"
        },
        "bonus": {
          "formula": "initiative_bonus",
          "description": "Bonus from perks or other sources",
          "json_path": "system.initiative.bonus"
        }
      },
      "json_paths": {
        "PER": "system.attributes.per.value",
        "AGI": "system.attributes.agi.value",
        "initiative_bonus": "system.initiative.bonus",
        "result": "system.initiative.value"
      },
      "validation": {
        "character": "Ellie (Level 4)",
        "PER": 8,
        "AGI": 6,
        "initiative_bonus": 0,
        "calculated": 14,
        "screenshot": 14,
        "status": "✓ VALIDATED"
      }
    },
    "melee_damage": {
      "formula": "STR 7-8: +1, STR 9-10: +2, STR 11+: +3, else 0",
      "description": "Melee damage bonus based on Strength",
      "logic": [
        {
          "condition": "STR >= 11",
          "result": 3
        },
        {
          "condition": "STR >= 9 && STR <= 10",
          "result": 2
        },
        {
          "condition": "STR >= 7 && STR <= 8",
          "result": 1
        },
        {
          "condition": "STR <= 6",
          "result": 0
        }
      ],
      "bonus": {
        "formula": "+ melee_damage_bonus",
        "description": "Additional bonus from perks/items",
        "json_path": "system.meleeDamage.bonus"
      },
      "json_paths": {
        "STR": "system.attributes.str.value",
        "melee_damage_bonus": "system.meleeDamage.bonus",
        "result": "system.meleeDamage.value"
      },
      "validation": {
        "character": "Ellie (Level 4)",
        "STR": 4,
        "melee_damage_bonus": 0,
        "calculated": 0,
        "screenshot": 0,
        "status": "✓ VALIDATED"
      }
    },
    "carry_weight": {
      "formula": "settings_base + (STR × 10)",
      "description": "Maximum carry weight in pounds",
      "components": {
        "base": {
          "value": 150,
          "description": "Base carry capacity (system setting)",
          "unit": "lbs"
        },
        "strength_bonus": {
          "formula": "STR × 10",
          "description": "Strength contributes 10 lbs per point"
        },
        "modifiers": {
          "formula": "+ carryWeight_mod",
          "description": "Additional modifiers from perks/items",
          "json_path": "system.carryWeight.mod"
        }
      },
      "json_paths": {
        "STR": "system.attributes.str.value",
        "carryWeight_base": "system.carryWeight.base",
        "carryWeight_mod": "system.carryWeight.mod",
        "result": "system.carryWeight.total"
      },
      "current_weight": {
        "formula": "sum(items[].system.weight × items[].system.quantity)",
        "description": "Total weight of all carried items",
        "json_path": "system.carryWeight.value"
      },
      "validation": {
        "character": "Ellie (Level 4)",
        "settings_base": 150,
        "STR": 4,
        "carryWeight_mod": 0,
        "calculated": 190,
        "screenshot": 190,
        "status": "✓ VALIDATED",
        "unit": "lbs"
      }
    },
    "next_level_xp": {
      "formula": "(Level × (Level - 1) / 2) × 100",
      "description": "XP required to reach the target Level",
      "note": "'Level' is the target level, not current level",
      "progression_table": {
        "2": 100,
        "3": 300,
        "4": 600,
        "5": 1000,
        "6": 1500,
        "7": 2100,
        "8": 2800,
        "9": 3600,
        "10": 4500,
        "formula_explanation": "Each entry calculated as: (targetLevel × (targetLevel-1) / 2) × 100"
      },
      "json_paths": {
        "current_level": "system.level.value",
        "next_level": "system.level.value + 1",
        "current_xp": "system.level.currentXP",
        "reward_xp": "system.level.rewardXP",
        "result": "system.level.nextLevelXP"
      },
      "validation": {
        "character": "Ellie (Level 4 → 5)",
        "target_level": 5,
        "calculated": 1000,
        "screenshot": 1000,
        "status": "✓ VALIDATED"
      }
    },
    "encumbrance_level": {
      "description": "Encumbrance penalty based on carried weight vs max capacity",
      "formula": "calculated from current_weight / max_carry_weight ratio",
      "thresholds": {
        "note": "Exact thresholds to be determined from FVTT system code",
        "likely_levels": [
          "0: Unencumbered",
          "1: Lightly encumbered",
          "2: Heavily encumbered",
          "3: Overencumbered"
        ]
      },
      "json_paths": {
        "current_weight": "system.carryWeight.value",
        "max_weight": "system.carryWeight.total",
        "result": "system.carryWeight.encumbranceLevel"
      }
    }
  },
  "body_part_resistances": {
    "description": "Body part resistances are calculated by aggregating equipped armor/clothing",
    "method": "sum all equipped items that cover each body part",
    "resistance_types": [
      "physical",
      "energy",
      "radiation",
      "poison"
    ],
    "body_parts": [
      "head",
      "torso",
      "armL",
      "armR",
      "legL",
      "legR"
    ],
    "json_paths": {
      "base_resistance": "system.body_parts.{part}.resistance.{type}",
      "item_coverage": "items[].system.location.{part}",
      "item_resistance": "items[].system.resistance.{type}"
    },
    "calculation": {
      "note": "For each body part, sum resistance values from all equipped items that cover that part"
    }
  },
  "notes": {
    "json_export_values": "Many calculated values are stored as 0 in JSON exports and must be recalculated",
    "fvtt_auto_calculation": "FVTT system auto-calculates these in prepareDerivedData() method",
    "character_sheet_generation": "When generating offline character sheets, apply these formulas to get correct values",
    "validation": "All formulas validated against Dr. Eloise Harper (Level 4) character export and screenshots"
  }
}
