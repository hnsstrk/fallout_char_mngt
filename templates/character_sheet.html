<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ character.name }} - Character Sheet</title>
    <style>
        /* ===== B&W PRINT OPTIMIZED STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 9pt;
            line-height: 1.3;
            color: #000;
            background: #fff;
        }

        .page {
            max-width: 180mm;
            margin: 0 auto;
            padding: 5mm;
            overflow: hidden;
        }

        /* ===== HEADER ===== */
        .header {
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 18pt;
            margin: 0;
        }

        .header-info {
            font-size: 10pt;
            margin-top: 3px;
        }

        .header-info span {
            margin-right: 20px;
        }

        /* ===== SECTIONS ===== */
        .section {
            margin-bottom: 10px;
            page-break-inside: avoid;
        }

        .section h2 {
            font-size: 11pt;
            background: #000;
            color: #fff;
            padding: 3px 8px;
            margin-bottom: 5px;
        }

        .section h3 {
            font-size: 10pt;
            border-bottom: 1px solid #000;
            margin: 8px 0 5px 0;
            padding-bottom: 2px;
        }

        /* ===== TABLES ===== */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9pt;
        }

        th, td {
            border: 1px solid #000;
            padding: 3px 5px;
            text-align: left;
        }

        th {
            background: #ddd;
            font-weight: bold;
        }

        .center {
            text-align: center;
        }

        /* ===== TWO COLUMN LAYOUT ===== */
        .two-col {
            width: 100%;
            border-collapse: collapse;
        }

        .two-col > tbody > tr > td {
            width: 50%;
            vertical-align: top;
            padding: 0;
            border: none;
        }

        .two-col > tbody > tr > td:first-child {
            padding-right: 5px;
        }

        .two-col > tbody > tr > td:last-child {
            padding-left: 5px;
        }

        /* ===== SPECIAL ATTRIBUTES ===== */
        .special-table td {
            text-align: center;
            font-weight: bold;
        }

        .special-table .attr-name {
            font-size: 8pt;
            font-weight: normal;
            color: #666;
        }

        .special-table .attr-value {
            font-size: 14pt;
        }

        /* ===== DERIVED STATS ===== */
        .stats-table td {
            text-align: center;
        }

        .stats-table .stat-name {
            font-size: 8pt;
            color: #666;
        }

        .stats-table .stat-value {
            font-size: 11pt;
            font-weight: bold;
        }

        /* ===== CONDITIONS ===== */
        .conditions-table td {
            text-align: center;
            font-size: 8pt;
        }

        .conditions-table .active {
            font-weight: bold;
            background: #ddd;
        }

        /* ===== BODY STATUS ===== */
        .body-table th {
            width: 20%;
        }

        .body-table .res-header {
            font-size: 7pt;
        }

        /* ===== SKILLS ===== */
        .skills-table .tag {
            text-align: center;
            font-weight: bold;
        }

        .skills-table .rank {
            text-align: center;
            font-weight: bold;
        }

        .skills-table .attr {
            text-align: center;
            font-size: 8pt;
            color: #666;
        }

        /* ===== ITEMS ===== */
        .item-name {
            font-weight: bold;
        }

        .item-desc {
            font-size: 8pt;
            color: #333;
            margin-top: 2px;
        }

        .item-stats {
            font-size: 8pt;
            color: #666;
        }

        /* ===== PERKS/TRAITS ===== */
        .perk-item {
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px dashed #ccc;
        }

        .perk-item:last-child {
            border-bottom: none;
        }

        .perk-name {
            font-weight: bold;
        }

        .perk-desc {
            font-size: 8pt;
            margin-top: 2px;
        }

        /* ===== APPENDIX ===== */
        .appendix {
            page-break-before: always;
        }

        .appendix h2 {
            font-size: 14pt;
            background: #000;
            color: #fff;
            padding: 5px 10px;
            margin-bottom: 10px;
        }

        .skill-detail {
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ccc;
        }

        .skill-detail:last-child {
            border-bottom: none;
        }

        .skill-detail-name {
            font-weight: bold;
            font-size: 10pt;
        }

        .skill-detail-info {
            font-size: 8pt;
            color: #666;
            margin-bottom: 3px;
        }

        .skill-detail-desc {
            font-size: 9pt;
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            html, body {
                width: 210mm;
                font-size: 9pt;
            }

            .page {
                max-width: 186mm;
                width: 186mm;
                padding: 0;
                margin: 0 auto;
            }

            .section {
                page-break-inside: avoid;
            }
        }

        @page {
            size: A4 portrait;
            margin: 12mm;
        }

        /* ===== UTILITY ===== */
        .empty {
            color: #999;
            font-style: italic;
        }

        .mono {
            font-family: 'Consolas', 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="page">
        <!-- HEADER -->
        <div class="header">
            <h1>{{ character.name }}</h1>
            <div class="header-info">
                <span><strong>Origin:</strong> {{ character.origin or 'Unknown' }}</span>
                <span><strong>Level:</strong> {{ character.level }}</span>
                <span><strong>XP:</strong> {{ derived.current_xp }} / {{ derived.next_level_xp }}</span>
            </div>
        </div>

        <!-- S.P.E.C.I.A.L. + DERIVED STATS -->
        <table class="two-col">
            <tr>
                <td>
                    <div class="section">
                        <h2>S.P.E.C.I.A.L.</h2>
                        <table class="special-table">
                            <tr>
                                <td><div class="attr-name">STR</div><div class="attr-value">{{ attributes.str }}</div></td>
                                <td><div class="attr-name">PER</div><div class="attr-value">{{ attributes.per }}</div></td>
                                <td><div class="attr-name">END</div><div class="attr-value">{{ attributes.end }}</div></td>
                                <td><div class="attr-name">CHA</div><div class="attr-value">{{ attributes.cha }}</div></td>
                                <td><div class="attr-name">INT</div><div class="attr-value">{{ attributes.int }}</div></td>
                                <td><div class="attr-name">AGI</div><div class="attr-value">{{ attributes.agi }}</div></td>
                                <td><div class="attr-name">LCK</div><div class="attr-value">{{ attributes.lck }}</div></td>
                            </tr>
                        </table>
                    </div>
                </td>
                <td>
                    <div class="section">
                        <h2>Derived Statistics</h2>
                        <table class="stats-table">
                            <tr>
                                <td><div class="stat-name">Health</div><div class="stat-value">{{ derived.current_health }}/{{ derived.max_health }}</div></td>
                                <td><div class="stat-name">Defense</div><div class="stat-value">{{ derived.defense }}</div></td>
                                <td><div class="stat-name">Initiative</div><div class="stat-value">{{ derived.initiative }}</div></td>
                            </tr>
                            <tr>
                                <td><div class="stat-name">Melee Dmg</div><div class="stat-value">+{{ derived.melee_damage }}</div></td>
                                <td><div class="stat-name">Carry</div><div class="stat-value">{{ derived.carry_weight_current }}/{{ derived.carry_weight_total }}</div></td>
                                <td><div class="stat-name">Radiation</div><div class="stat-value">{{ derived.radiation }}</div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>

        <!-- CONDITIONS + BODY STATUS -->
        <table class="two-col">
            <tr>
                <td>
                    <div class="section">
                        <h2>Conditions</h2>
                        <table class="conditions-table">
                            <tr>
                                <td>Hunger: {{ conditions.hunger }}</td>
                                <td>Thirst: {{ conditions.thirst }}</td>
                                <td>Sleep: {{ conditions.sleep }}</td>
                                <td>Fatigue: {{ conditions.fatigue }}</td>
                            </tr>
                            <tr>
                                <td>Intox: {{ conditions.intoxication }}</td>
                                <td{% if conditions.alcoholic %} class="active"{% endif %}>Alcoholic: {{ 'Yes' if conditions.alcoholic else 'No' }}</td>
                                <td{% if conditions.well_rested %} class="active"{% endif %} colspan="2">Well Rested: {{ 'Yes' if conditions.well_rested else 'No' }}</td>
                            </tr>
                        </table>
                    </div>
                </td>
                <td>
                    <div class="section">
                        <h2>Body Status</h2>
                        <table class="body-table">
                            <tr>
                                <th>Part</th>
                                <th class="res-header center">E</th>
                                <th class="res-header center">P</th>
                                <th class="res-header center">Po</th>
                                <th class="res-header center">R</th>
                            </tr>
                            {% for part in body_parts %}
                            <tr>
                                <td>{{ part.name }}</td>
                                <td class="center mono">{{ part.energy }}</td>
                                <td class="center mono">{{ part.physical }}</td>
                                <td class="center mono">{{ part.poison }}</td>
                                <td class="center mono">{{ part.radiation }}</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </td>
            </tr>
        </table>

        <!-- SKILLS (without descriptions - those go to appendix) -->
        <div class="section">
            <h2>Skills</h2>
            <table class="skills-table">
                <tr>
                    <th>Skill</th>
                    <th style="width:40px" class="center">Tag</th>
                    <th style="width:40px" class="center">Rank</th>
                    <th style="width:40px" class="center">Attr</th>
                </tr>
                {% for skill in skills %}
                <tr>
                    <td>{{ skill.name }}</td>
                    <td class="tag">{{ '✓' if skill.tag else '' }}</td>
                    <td class="rank">{{ skill.rank }}</td>
                    <td class="attr">{{ skill.attribute }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- PERKS + TRAITS -->
        <table class="two-col">
            <tr>
                <td>
                    <div class="section">
                        <h2>Perks</h2>
                        {% if perks %}
                            {% for perk in perks %}
                            <div class="perk-item">
                                <span class="perk-name">{{ perk.name }}</span>
                                {% if perk.rank > 1 %}<span class="item-stats">(Rank {{ perk.rank }})</span>{% endif %}
                                {% if perk.description %}<div class="perk-desc">{{ perk.description }}</div>{% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="empty">None</p>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div class="section">
                        <h2>Traits</h2>
                        {% if traits %}
                            {% for trait in traits %}
                            <div class="perk-item">
                                <span class="perk-name">{{ trait.name }}</span>
                                {% if trait.description %}<div class="perk-desc">{{ trait.description }}</div>{% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="empty">None</p>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>

        <!-- ADDICTIONS + DISEASES -->
        <table class="two-col">
            <tr>
                <td>
                    <div class="section">
                        <h2>Addictions</h2>
                        {% if addictions %}
                            {% for item in addictions %}<div>{{ item.name }}</div>{% endfor %}
                        {% else %}
                            <p class="empty">None</p>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div class="section">
                        <h2>Diseases</h2>
                        {% if diseases %}
                            {% for item in diseases %}<div>{{ item.name }}</div>{% endfor %}
                        {% else %}
                            <p class="empty">None</p>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>

        <!-- WEAPONS -->
        <div class="section">
            <h2>Weapons</h2>
            {% if weapons %}
                <table>
                    <tr>
                        <th>Weapon</th>
                        <th class="center">Damage</th>
                        <th class="center">Range</th>
                        <th class="center">Rate</th>
                        <th>Qualities</th>
                    </tr>
                    {% for weapon in weapons %}
                    <tr>
                        <td class="item-name">{{ weapon.name }}</td>
                        <td class="center">{{ weapon.damage }} {{ weapon.damage_type }}</td>
                        <td class="center">{{ weapon.range or '-' }}</td>
                        <td class="center">{{ weapon.fire_rate or '-' }}</td>
                        <td>{{ weapon.qualities or '-' }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p class="empty">None</p>
            {% endif %}

            {% if ammo %}
            <h3>Ammunition</h3>
            <table>
                <tr>
                    <th>Type</th>
                    <th class="center" style="width:60px">Qty</th>
                </tr>
                {% for item in ammo %}
                <tr>
                    <td>{{ item.name }}</td>
                    <td class="center mono">{{ item.quantity }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}
        </div>

        <!-- APPAREL / ROBOT ARMOR -->
        <div class="section">
            {% if is_robot %}
            <h2>Robot Armor</h2>
            {% if robot_armor %}
                <table>
                    <tr>
                        <th>Item</th>
                        <th class="center">E</th>
                        <th class="center">P</th>
                        <th class="center">Po</th>
                        <th class="center">R</th>
                    </tr>
                    {% for item in robot_armor %}
                    <tr>
                        <td class="item-name">{{ item.name }}{% if item.equipped %} ✓{% endif %}</td>
                        <td class="center">{{ item.energy }}</td>
                        <td class="center">{{ item.physical }}</td>
                        <td class="center">{{ item.poison }}</td>
                        <td class="center">{{ item.radiation }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p class="empty">None</p>
            {% endif %}
            {% else %}
            <h2>Apparel</h2>
            {% if apparel %}
                <table>
                    <tr>
                        <th>Item</th>
                        <th>Locations</th>
                        <th>Resistances</th>
                    </tr>
                    {% for item in apparel %}
                    <tr>
                        <td class="item-name">{{ item.name }}</td>
                        <td>{{ item.locations or '-' }}</td>
                        <td>{{ item.resistances or '-' }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p class="empty">None</p>
            {% endif %}
            {% endif %}
        </div>

        <!-- ROBOT MODULES (only for robots) -->
        {% if is_robot and robot_mods %}
        <div class="section">
            <h2>Robot Modules</h2>
            <table>
                <tr>
                    <th>Module</th>
                    <th>Effect</th>
                </tr>
                {% for mod in robot_mods %}
                <tr>
                    <td class="item-name">{{ mod.name }}{% if mod.equipped %} ✓{% endif %}</td>
                    <td>{{ mod.effect or mod.description or '-' }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        <!-- CONSUMABLES -->
        <div class="section">
            <h2>Consumables</h2>
            {% if consumables %}
                <table>
                    <tr>
                        <th>Item</th>
                        <th class="center" style="width:40px">Qty</th>
                        <th>Effect</th>
                    </tr>
                    {% for item in consumables %}
                    <tr>
                        <td class="item-name">{{ item.name }}</td>
                        <td class="center mono">{{ item.quantity }}</td>
                        <td class="item-stats">{{ item.description[:80] ~ '...' if item.description and item.description|length > 80 else item.description or '-' }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p class="empty">None</p>
            {% endif %}
        </div>

        <!-- GEAR -->
        <div class="section">
            <h2>Gear &amp; Miscellany</h2>
            {% if gear %}
                <table>
                    <tr>
                        <th>Item</th>
                        <th class="center" style="width:40px">Qty</th>
                        <th>Type</th>
                    </tr>
                    {% for item in gear %}
                    <tr>
                        <td class="item-name">{{ item.name }}</td>
                        <td class="center mono">{{ item.quantity }}</td>
                        <td class="item-stats">{{ item.type_label or '-' }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p class="empty">None</p>
            {% endif %}
        </div>

        <!-- BIOGRAPHY -->
        {% if biography %}
        <div class="section">
            <h2>Data</h2>
            <p>{{ biography }}</p>
        </div>
        {% endif %}

    </div>

    <!-- APPENDIX: SKILL DESCRIPTIONS -->
    {% if include_appendix %}
    <div class="page appendix">
        <h2>Appendix: Skill Descriptions</h2>
        {% for skill in skills %}
        {% if skill.description %}
        <div class="skill-detail">
            <div class="skill-detail-name">{{ skill.name }}</div>
            <div class="skill-detail-info">{{ skill.attribute }} | Rank {{ skill.rank }}{% if skill.tag %} | Tagged{% endif %}</div>
            <div class="skill-detail-desc">{{ skill.description }}</div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% endif %}

</body>
</html>
